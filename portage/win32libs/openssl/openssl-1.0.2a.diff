diff -Nru -x '*~' openssl-1.0.2a.orig/crypto/perlasm/x86masm.pl openssl-1.0.2a/crypto/perlasm/x86masm.pl
--- openssl-1.0.2a.orig/crypto/perlasm/x86masm.pl   2015-03-19 14:30:36.000000000 +0100
+++ openssl-1.0.2a/crypto/perlasm/x86masm.pl    2015-06-01 00:18:36.458732400 +0200
@@ -18,10 +18,10 @@
 
     if ($opcode =~ /lea/ && @arg[1] =~ s/.*PTR\s+(\(.*\))$/OFFSET $1/) # no []
     {  $opcode="mov";  }
-    elsif ($opcode !~ /movq/)
+    elsif ($opcode !~ /mov[dq]$/)
     {  # fix xmm references
-   $arg[0] =~ s/\b[A-Z]+WORD\s+PTR/XMMWORD PTR/i if ($arg[1]=~/\bxmm[0-7]\b/i);
-   $arg[1] =~ s/\b[A-Z]+WORD\s+PTR/XMMWORD PTR/i if ($arg[0]=~/\bxmm[0-7]\b/i);
+   $arg[0] =~ s/\b[A-Z]+WORD\s+PTR/XMMWORD PTR/i if ($arg[-1]=~/\bxmm[0-7]\b/i);
+   $arg[-1] =~ s/\b[A-Z]+WORD\s+PTR/XMMWORD PTR/i if ($arg[0]=~/\bxmm[0-7]\b/i);
     }
 
     &::emit($opcode,@arg);
@@ -160,13 +160,13 @@
 {   push(@out,"PUBLIC\t".&::LABEL($_[0],$nmdecor.$_[0])."\n");   }
 
 sub ::data_byte
-{   push(@out,("DB\t").join(',',@_)."\n"); }
+{   push(@out,("DB\t").join(',',splice(@_,0,16))."\n") while(@_); }
 
 sub ::data_short
-{   push(@out,("DW\t").join(',',@_)."\n"); }
+{   push(@out,("DW\t").join(',',splice(@_,0,8))."\n") while(@_); }
 
 sub ::data_word
-{   push(@out,("DD\t").join(',',@_)."\n"); }
+{   push(@out,("DD\t").join(',',splice(@_,0,4))."\n") while(@_); }
 
 sub ::align
 {   push(@out,"ALIGN\t$_[0]\n");   }
diff --git a/crypto/sha/asm/sha1-586.pl b/crypto/sha/asm/sha1-586.pl
index 8377299..4895eb3 100644
--- a/crypto/sha/asm/sha1-586.pl
+++ b/crypto/sha/asm/sha1-586.pl
@@ -450,7 +450,7 @@ sub sha1msg2 { sha1op38(0xca,@_); }
&sub ("esp",32);

&movdqu ($ABCD,&QWP(0,$ctx));
- &movd ($E,&QWP(16,$ctx));
+ &movd ($E,&DWP(16,$ctx));
&and ("esp",-32);
&movdqa ($BSWAP,&QWP(0x50,$tmp1)); # byte-n-word swap